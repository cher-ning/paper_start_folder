---
title: "Emergency Homeless Shelter Availabilities Across Toronto"
author: "Cher Ning-Li"
thanks: "Code and data are available at: https://github.com/cher-ning/shelter_occupancies"
date: today
date-format: long
abstract: "In this paper I analyze the occupancy and capacity of emergency homeless shelters across Toronto."
#TODO Complete abstract after paper.
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)

data <- read_csv(here::here("data/analysis_data/analysis_data.csv"))
```


# Introduction



Next, the @sec-data section will introduce the dataset used for the present analysis and the data cleaning methods applied. The following @sec-results will then go more into depth to discover trends and patterns in the data while @sec-discussion will connect these findings to current literature to understand the scope and urgency of the issues at hand.  


# Data {#sec-data}
You can and should cross-reference sections and sub-sections. We use @citeR and @citeTidyverse


The dataset used for analysis is of occupancy rate of shelters in the year 2024 (@fig-occupancyrate-vs-month), from @opendatatoronto.

# check if occupancy rate varies over months
```{r}
#| label: fig-occupancyrate-vs-month
#| tbl-cap: Shelter Occupancy Rate in 2024 Over the Months
#| echo: false

rate_means <- data %>% select(month, occupancy_rate) %>% group_by(month) %>% 
  summarise(mean_occupancy_rate = mean(occupancy_rate))

rate_means$month <- month.abb[rate_means$month]
  
knitr::kable(rate_means, align ="c", col.names= c("Month", "Mean Occupancy Rate"))

```



# first find num shelters per fsa
```{r}
#| label: fig-fsa-numshelters
#| eval: true
#| tbl-cap: "Number of Unique Shelters vs FSA"
#| echo: false

fsa_shelters <- data %>% select(fsa, location_id) %>% group_by(fsa) %>% 
  summarise(numshelters = n_distinct(location_id))

fsa_shelters <- fsa_shelters[order(fsa_shelters$numshelters, decreasing = TRUE), ]
knitr::kable(top_n(fsa_shelters,5,numshelters), align ="c", col.names= c("FSA", "Number of Shelter Locations"))

```
```{r}
hist(fsa_shelters$numshelters)
```

```{r}
#| label: fig-regionoccupancy
#| fig-cap: Average Bed Occupancy of Shelters Across Different FSA Regions
#| echo: false

region_occupancy <- data %>% select(fsa, occupied_beds) %>% group_by(fsa) %>%
  summarise(mean_occupied = mean(occupied_beds))

hist(region_occupancy$mean_occupied)

```
```{r}
#| label: fig-fundingcapacity-histogram
#| fig-cap: "Funding Capacities of Toronto Emergency Shelters"
#| echo: false

hist(data$funding_capacity)
```

# discuss summary stats of funding capacity in text, can consider to only include top few rows of this table
```{r}
#| label: fig-fsa-fundingcapacity
#| eval: true
#| tbl-cap: "Funding Capacities of Toronto Emergency Shelters"
#| echo: false

funding_means <- data %>% select(fsa, funding_capacity) %>% group_by(fsa) %>% 
  summarise(mean_fundingcap = mean(funding_capacity))

funding_means <- funding_means[order(funding_means$mean_fundingcap, decreasing = TRUE), ]

#knitr::kable(top_n(funding_means,5,mean_fundingcap), align ="c", col.names= c("FSA", "Mean Funding Capacity"))
hist(funding_means$mean_fundingcap)
```

```{r}
#| label: fig-unavailabilities-by-fsa
#| eval: true
#| tbl-cap: "Number of Unavailable Beds/Night At Different FSAs"
#| echo: false

unavailable_beds <- data %>% select(fsa, unavailable_beds) %>% group_by(fsa) %>% 
  summarise(mean_unavailable = mean(unavailable_beds))

unavailable_beds <- unavailable_beds[order(unavailable_beds$mean_unavailable, decreasing = TRUE), ]

knitr::kable(top_n(unavailable_beds,5,unavailable_beds$mean_unavailable), 
             align ="c", col.names= c("FSA", "Average Number of Unavailable Beds"))
#hist(unavailable_beds$mean_unavailable)
```




# Results {#sec-results}

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

```


# Discussion {#sec-discussion}

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details



\newpage


# References